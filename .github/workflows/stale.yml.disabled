name: Stale

on:
  schedule:
    - cron: "0 3 * * *"
  workflow_dispatch:

permissions:
  issues: write
  pull-requests: write

jobs:
  stale:
    name: Mark and close stale items
    runs-on: ubuntu-latest
    steps:
      - name: Ensure stale label exists
        uses: actions/github-script@v7
        with:
          script: |
            const { owner, repo } = context.repo;
            try {
              await github.rest.issues.getLabel({ owner, repo, name: "stale" });
            } catch (error) {
              if (error.status !== 404) throw error;
              await github.rest.issues.createLabel({
                owner,
                repo,
                name: "stale",
                color: "ffffff",
                description: "No recent activity"
              });
            }

      - name: Mark stale issues and pull requests
        uses: actions/stale@v9
        with:
          stale-issue-label: stale
          stale-pr-label: stale
          exempt-issue-labels: pinned,security,never-stale
          exempt-pr-labels: pinned,security,never-stale
          days-before-issue-stale: 45
          days-before-issue-close: 14
          days-before-pr-stale: 30
          days-before-pr-close: 14
          stale-issue-message: >
            This issue has had no activity for 45 days and is now marked as stale.
            If this is still relevant, add an update and we will keep it open.
          stale-pr-message: >
            This pull request has had no activity for 30 days and is now marked as stale.
            If it is still active, add an update and we will keep it open.
          close-issue-message: >
            Closing this issue due to inactivity after it was marked stale.
            Feel free to reopen with updated context.
          close-pr-message: >
            Closing this pull request due to inactivity after it was marked stale.
            It can be reopened with an update.
